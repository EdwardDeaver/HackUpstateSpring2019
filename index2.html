<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
 <meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-1">
  </head>
  <body>
    <script language="javascript" type="text/javascript" src="p5/p5.js"></script>

    <script language="javascript" type="text/javascript" src="p5/addons/p5.dom.js"></script>
    <script language="javascript" type="text/javascript" src="p5/addons/p5.sound.js"></script>


<script type="text/javascript">

  var osc;
  var playing = false;

  function setup() {

  backgroundColor = color(255,0,255);
  textAlign(CENTER);

  osc1 = new p5.Oscillator();
  osc1.setType('sawtooth');
  osc1.amp(0);
  osc1.start();
  osc2 = new p5.Oscillator();
  osc2.setType('square');
  osc2.amp(0);
  osc2.start();
  osc3 = new p5.Oscillator();
  osc3.setType('sine');
  osc3.amp(0);
  osc3.start();
  getFile("https://municipal.systems/v1/places/syc-ny/dataTypes/transit-route/data?key=f15a3868-3d82-47d3-9288-b4c41309904c&filters%5B0%5D%5Bdata%5D%5Boperators%5D%5B%24contains%5D%5B0%5D=Centro", function(size) {
            loadMaps(size.response);
        }, "vehicleLocations");
  }

  function draw() {
  background(backgroundColor)
  text('click to play', width/2, height/2);
  }


  function getFile(url, callback, target) {
          var xhr = new XMLHttpRequest();
          xhr.responseType = 'json';
          xhr.open("GET", url, true); // Notice "HEAD" instead of "GET",
          xhr.onreadystatechange = function() {
              if (this.readyState == this.DONE) {

                console.log(xhr.response);
                callback(xhr);
              }
          };
          xhr.send();
      }
async  function loadMaps(BusMaps){
    console.log(BusMaps.results);
    for (var i = 0; i < BusMaps.results.length; i++) {
      var realFixedCords = [];
    //  if(stopLOOP == true){
    //    break;
    //  }
    osc1.amp(1);

    osc1.freq((parseInt(BusMaps.results[i].data.color, 16) - 60) / (600 - 60)/70);
    await sleep(1000);

      for (var z = 0; z < BusMaps.results[i].data.path.coordinates.length; z++) {
        osc2.amp(1);
        osc3.amp(1);
        console.log([BusMaps.results[i].data.path.coordinates[z][1], BusMaps.results[i].data.path.coordinates[z][0]]);
        osc2.freq(BusMaps.results[i].data.path.coordinates[z][1]* Math.random()*10, 1);
        console.log(BusMaps.results[i].data.path.coordinates[z][1]*2);
        console.log("HELLO NEXT IS NORMALIZED");
        console.log((BusMaps.results[i].data.path.coordinates[z][1]*10000)/ (600 - 60* Math.random()));
        console.log(BusMaps.results[i].data.path.coordinates[z][0]*-5);
        osc3.freq((BusMaps.results[i].data.path.coordinates[z][0]*-10)/ (600 - 60* Math.random()));
        realFixedCords[z] = [BusMaps.results[i].data.path.coordinates[z][1], BusMaps.results[i].data.path.coordinates[z][0]];
        await sleep(3000);

      }
      console.log(BusMaps.results[i].data.color);
      console.log(parseInt(BusMaps.results[i].data.color, 16));
      console.log("THIS IS OSC1");
      console.log((parseInt(BusMaps.results[i].data.color, 16) - 60) / (600 - 60)/70);

            console.log((parseInt(BusMaps.results[i].data.color, 16) - 60) / (600 - 60)/100);
    //  createPolyLine(realFixedCords, BusMaps.results[i].data.color, BusMaps.results[i].data.name, BusMaps.results[i].data.notes) ;
      //realFixedCords = []
      //console.log(BusMaps.results[i].data.path.coordinates[1], BusMaps.results[i].data.path.coordinates[0]);
  }
    }

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}



    </script>
    <div id="div1" class="clueless"></div>
  </body>
</html>
